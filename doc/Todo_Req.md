# Todo App 需求文档

## 1. 产品概述
一款安卓平台的时间管理应用，包含待办事项、习惯追踪、日记记录和系统设置四大核心模块。

## 2. 功能需求

### 2.1 待办模块
#### 2.1.1 核心功能
- **添加待办**
  - 必填字段：内容
  - 可选字段：预估时间（分钟），截止时间（精确到分钟）
  - 自动生成：唯一ID（仅内部使用）、创建时间、默认状态（待办）
  - 特殊规则：
    - 填写预估时间后强制要求计时完成

- **编辑待办**
  - 可修改字段：内容、截止时间、预估时间
  - 禁止修改：ID、创建时间
- **删除待办**

- **状态管理**
  - 三种状态：待办（默认）→ 进行中 → 完成
  - 计时规则：
    - 无预估时间：可直接标记完成
    - 有预估时间：必须完成计时才能自动转为"完成"状态
    - 异常处理：跳过计时/停止计时 → 状态回滚为"待办"

#### 2.1.2 排序系统
- **自动排序**
  - 第一优先级：用户设置的手动优先级值（默认50）
  - 第二优先级：截止时间（升序）
  - 第三优先级：创建时间（升序）

- **手动调整**
  - 交互方式：长按拖拽
  - 重排逻辑：被移动项获得新优先级值（1-N连续整数）

### 2.2 习惯模块
#### 2.2.1 周期系统
| 周期类型 | 截止时间规则       | 重置规则               |
|----------|--------------------|------------------------|
| 每日     | 当天23:59          | 次日00:00刷新          |
| 每周     | 当周周日23:59      | 下周一00:00刷新        |
| 每月     | 当月最后一天23:59   | 次月1日00:00刷新       |
| 自定义   | 按N天后23:59计算   | N天后的次日00:00刷新   |

#### 2.2.2 时间和次数
- 习惯有两种，一种按照总时间评价，一种按照完成次数评价。
- 如果选择时间，可以不用设置次数
- 周期内总计时时间达标->标记为"完成"
- 如果设置次数，必须设置完成次数≥1
- 周期内完成次数达标 → 标记为"完成"
- 设置次数的情况下，也可以设置预估时间，这个时间表示每一次的时间。
- 周期结束未达标 → 不继承次数，完全重置

#### 2.2.3 核心功能
- **添加习惯**
  - 必填字段：周期，内容
  - 可选字段：次数，预估时间（分钟），截止时间（精确到分钟）
  - 自动生成：唯一ID（仅内部使用）、创建时间、默认状态（待办）
- **编辑习惯**
  - 可修改字段：内容、次数，截止时间、预估时间
  - 禁止修改：ID、创建时间，周期
- **删除习惯**

### 2.3 日记模块
#### 2.3.1 基础功能
- **模板系统**
  - 预设模板需包含：日期自动插入（格式：YYYY-MM-DD）
  - 示例模板：
    ```
   {日期}		{天气}
    完成事项：{{items}}
    心得体会：
    ```

- **评价系统**
  - 维度管理：
    - 最大5个维度
    - 维度名称限制：10字符（支持中英文）
    - 评分范围：1-5星
  - 历史数据：删除维度后仍保留原始记录

#### 2.3.2 智能生成（可选）
- 触发条件：用户手动请求
- 输入数据：
  ```json
  {
    "date": "2024-03-20",
    "completed_todos": ["写文档", "健身"],
    "habit_progress": {"晨跑": "3/5"},
    "ratings": {"效率": 4, "心情": 3}
  }
  ```
- 输出要求：生成后可编辑，需用户确认保存

### 2.4 设置模块
#### 2.4.1 分组结构
	```
	通用设置
	├─ 声音提示开关
	├─ 默认排序规则（优先级/截止时间）
	└─ 新待办默认预估时间

	数据管理
	├─ 数据备份
	└─ 数据恢复
	```
#### 2.4.2 配置项
设置项	类型	默认值
启用计时完成提醒音	开关	开
习惯周期结束提醒	开关	关
默认日记模板	下拉框	简洁模板
### 2.5 用户系统（Mock版）
登录流程
输入字段：用户名、密码
交互规则：
模拟1秒网络延迟
错误提示："登录失败"（不区分具体原因）
用户数据
存储字段：用户名、头像（预设图标）
头像规格：100x100px PNG格式


## 3. 数据规范

### 3.1 核心数据结构

#### 3.1.1 待办事项
```typescript
interface Todo {
  id: uuid;                  // UUID v4
  content: string;             // 最大200字符
  dueDate: date;             // ISO8601格式
  tomatoTime: number;   // 1-1440
  status: 'pending'|'inProgress'|'done';
  priority: number;            // 1-100
  createdAt: date;           // 只读
}
```

#### 3.1.2 习惯记录
```typescript
interface Habit extends Todo {
  period: 'daily'|'weekly'|'monthly'|'custom';
  targetCount: number;         // ≥1
  completedCount: number;
  periodEndDate: date;       // 自动计算
}
```

#### 3.1.3 日记条目
```typescript
interface Diary {
  date: date;                // YYYY-MM-DD
  content: string;
  ratings: Record<string, 1|2|3|4|5>; // 维度:评分
}
```

### 3.2 持久化方案

#### 3.2.1 存储结构
```json
当前数据格式：
  {
    "todos": [],
    "habits": [],
    "settings": {}
  }
 历史数据每天存一个文件：
 /history/YYYY-MM-DD.json",

```


### 3.3 数据约束

| 实体 | 约束条件 |
|------|----------|
| 待办 | 有预估时间时必须计时完成 |
| 习惯 | targetCount ≥ completedCount |
| 日记 | 最多5个评价维度 |

  
## 4. 国际化支持

### 4.1 语言与区域设置

```typescript
interface LocaleConfig {
  /**
   * 支持的语言包
   * @key 语言代码 (BCP 47格式)
   * @value 显示名称
   */
  supportedLocales: {
    'zh-CN': '简体中文',
    'en-US': 'English',
    'ja-JP': '日本語'
  };

  // 默认语言设置
  defaultLocale: 'zh-CN';

  // 日期格式配置
  dateFormats: {
    short: {
      'zh-CN': 'YYYY-MM-DD',
      'en-US': 'MM/DD/YYYY',
      'ja-JP': 'YYYY/MM/DD'
    },
    long: {
      'zh-CN': 'YYYY年M月D日',
      'en-US': 'MMMM D, YYYY',
      'ja-JP': 'YYYY年M月D日'
    }
  };
}
```
